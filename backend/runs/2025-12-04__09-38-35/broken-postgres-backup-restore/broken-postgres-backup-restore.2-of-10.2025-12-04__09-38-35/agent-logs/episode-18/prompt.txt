alice_smith,3682.87
victor_von,3451.21
donna_noble,3225.49
xavier_prof,2990.51
nick_fury,2709.20
wade_wilson,2678.95
tony_stark,2637.00
frank_white,2539.97
charlie_brown,2525.32
root@4fba2045470e:/backup# su - postgres -c "psql -d production_db -t -A -c \"SELECT COUNT(*) FROM users WHERE status = 'active';\""; tmux wait -S done
13
root@4fba2045470e:/backup# cat > /tmp/fix_reports.py << 'EOF'
> import subprocess
>
> # Fix db_stats.txt with correct active users count
> def run_query(query):
>     result = subprocess.run(
>         ['su', '-', 'postgres', '-c', f'psql -d production_db -t -A -c "{query}"'],
>         capture_output=True, text=True
>     )
>     return result.stdout.strip()
>
> total_users = run_query('SELECT COUNT(*) FROM users;')
> active_users = run_query("SELECT COUNT(*) FROM users WHERE status = 'active';")
> total_transactions = run_query('SELECT COUNT(*) FROM transactions;')
> total_amount = run_query('SELECT ROUND(SUM(amount), 2) FROM transactions;')
> avg_per_user = run_query('SELECT ROUND(SUM(amount) / COUNT(DISTINCT user_id), 2) FROM transactions;')
>
> with open('/backup/db_stats.txt', 'w') as f:
>     f.write('DATABASE STATISTICS\n')
>     f.write('==================\n')
>     f.write(f'Total Users: {total_users}\n')
>     f.write(f'Active Users: {active_users}\n')
>     f.write(f'Total Transactions: {total_transactions}\n')
>     f.write(f'Total Amount: {total_amount}\n')
>     f.write(f'Average per User: {avg_per_user}\n')
>
> print('Fixed db_stats.txt')
> EOF
root@4fba2045470e:/backup#
