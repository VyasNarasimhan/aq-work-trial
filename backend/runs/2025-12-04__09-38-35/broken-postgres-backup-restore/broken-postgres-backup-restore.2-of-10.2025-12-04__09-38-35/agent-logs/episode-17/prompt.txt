> GROUP BY u.username
> ORDER BY total_amount DESC, u.username ASC
> LIMIT 10;
> '''
>
> result = subprocess.run(
>     ['su', '-', 'postgres', '-c', f"psql -d production_db -t -A -F',' -c \"{top_users_query}\""],
>     capture_output=True, text=True
> )
>
> with open('/backup/top_users.csv', 'w') as f:
>     f.write('username,total_amount\n')
>     f.write(result.stdout)
>
> print('Generated top_users.csv')
> EOF
root@4fba2045470e:/backup# python3 /tmp/generate_reports.py; tmux wait -S done
Generated db_stats.txt
Generated top_users.csv
root@4fba2045470e:/backup# cat /backup/db_stats.txt; tmux wait -S done
DATABASE STATISTICS
==================
Total Users: 30
Active Users:
Total Transactions: 100
Total Amount: 53109.46
Average per User: 1770.32
root@4fba2045470e:/backup# cat /backup/top_users.csv; tmux wait -S done
username,total_amount
zara_ahmed,4400.17
alice_smith,3682.87
victor_von,3451.21
donna_noble,3225.49
xavier_prof,2990.51
nick_fury,2709.20
wade_wilson,2678.95
tony_stark,2637.00
frank_white,2539.97
charlie_brown,2525.32
root@4fba2045470e:/backup#
