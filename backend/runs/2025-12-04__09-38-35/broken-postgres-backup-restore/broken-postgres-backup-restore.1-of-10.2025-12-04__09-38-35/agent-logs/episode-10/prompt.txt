root@bbbc5313bf43:/backup# python3 /backup/import_transactions.py; tmux wait -S done
Traceback (most recent call last):
  File "/backup/import_transactions.py", line 2, in <module>
    import psycopg2
ModuleNotFoundError: No module named 'psycopg2'
root@bbbc5313bf43:/backup# su - postgres -c "psql -d production_db -c 'SELECT COUNT(*) FROM transactions;'"; tmux wait -S done
 count
-------
     0
(1 row)

root@bbbc5313bf43:/backup# cat > /backup/json_to_csv.py << 'EOF'
> import json
> import csv
>
> # Read valid transactions
> with open('/backup/valid_transactions.json', 'r') as f:
>     transactions = json.load(f)
>
> # Write to CSV
> with open('/backup/transactions_import.csv', 'w', newline='') as f:
>     fieldnames = ['transaction_id', 'user_id', 'amount', 'timestamp', 'description']
>     writer = csv.DictWriter(f, fieldnames=fieldnames)
>     writer.writeheader()
>     writer.writerows(transactions)
>
> print(f'Converted {len(transactions)} transactions to CSV')
> EOF
root@bbbc5313bf43:/backup# python3 /backup/json_to_csv.py; tmux wait -S done
Converted 100 transactions to CSV
root@bbbc5313bf43:/backup# su - postgres -c "psql -d production_db -c \"COPY transactions FROM '/backup/transactions_import.csv' WITH (FORMAT csv, HEADER true);
\""; tmux wait -S done
COPY 100
root@bbbc5313bf43:/backup# su - postgres -c "psql -d production_db -c 'SELECT COUNT(*) FROM transactions;'"; tmux wait -S done
 count
-------
   100
(1 row)

root@bbbc5313bf43:/backup#
