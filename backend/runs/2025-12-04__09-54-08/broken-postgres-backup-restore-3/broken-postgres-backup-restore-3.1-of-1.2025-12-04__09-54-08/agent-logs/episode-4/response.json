{
    "state_analysis": "The psycopg2 module is not installed. I need to either install it or use a different approach. I'll use psql's COPY command to import the CSV data instead of using Python's psycopg2.",
    "explanation": "I'll modify the approach to: 1) Use Python only for cleaning the data files, 2) Use psql's COPY command to import the cleaned data into the database.",
    "commands": [
        {
            "keystrokes": "cat > clean_users.py << 'EOF'\nimport csv\n\n# Valid status values\nVALID_STATUSES = {'active', 'inactive', 'suspended'}\n\ndef is_valid_email(email):\n    \"\"\"Check if email contains @\"\"\"\n    return email and '@' in email\n\ndef clean_users():\n    \"\"\"Clean users_export.csv and return valid rows\"\"\"\n    valid_rows = []\n    \n    with open('/backup/users_export.csv', 'r') as f:\n        reader = csv.DictReader(f)\n        for row in reader:\n            # Check for missing user_id\n            if not row.get('user_id') or row['user_id'].strip() == '':\n                continue\n            \n            # Check for empty username\n            if not row.get('username') or row['username'].strip() == '':\n                continue\n            \n            # Check for invalid email (must contain @)\n            if not is_valid_email(row.get('email', '')):\n                continue\n            \n            # Check for invalid status\n            if row.get('status', '').strip().lower() not in VALID_STATUSES:\n                continue\n            \n            valid_rows.append(row)\n    \n    return valid_rows\n\ndef write_clean_csv(rows):\n    \"\"\"Write cleaned data to clean_users.csv\"\"\"\n    with open('/backup/clean_users.csv', 'w', newline='') as f:\n        if rows:\n            writer = csv.DictWriter(f, fieldnames=['user_id', 'username', 'email', 'created_at', 'status'])\n            writer.writeheader()\n            writer.writerows(rows)\n\nif __name__ == '__main__':\n    print(\"Cleaning users data...\")\n    valid_rows = clean_users()\n    print(f\"Valid rows: {len(valid_rows)}\")\n    \n    print(\"Writing clean_users.csv...\")\n    write_clean_csv(valid_rows)\n    \n    print(\"Done!\")\nEOF\n",
            "is_blocking": true,
            "timeout_sec": 5
        },
        {
            "keystrokes": "python3 clean_users.py\n",
            "is_blocking": true,
            "timeout_sec": 5
        },
        {
            "keystrokes": "head -5 clean_users.csv\n",
            "is_blocking": true,
            "timeout_sec": 5
        },
        {
            "keystrokes": "wc -l clean_users.csv\n",
            "is_blocking": true,
            "timeout_sec": 5
        }
    ],
    "is_task_complete": false
}