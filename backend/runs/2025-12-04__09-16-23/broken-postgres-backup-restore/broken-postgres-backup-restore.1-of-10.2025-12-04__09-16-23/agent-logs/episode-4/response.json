{
    "state_analysis": "PostgreSQL authentication is failing. I need to connect as the correct user. Since I'm running as root, I should either switch to the postgres user or modify the authentication. Let me try connecting without specifying a user or using sudo to switch to postgres user.",
    "explanation": "I'll switch to the postgres user to run psql commands, create the database and tables, then import the data using psql's COPY command and JSON processing tools.",
    "commands": [
        {
            "keystrokes": "su - postgres -c \"psql -c 'CREATE DATABASE production_db;'\"\n",
            "is_blocking": true,
            "timeout_sec": 5.0
        },
        {
            "keystrokes": "su - postgres -c \"psql -d production_db -f /backup/database.sql\"\n",
            "is_blocking": true,
            "timeout_sec": 10.0
        },
        {
            "keystrokes": "su - postgres -c \"psql -d production_db -c \\\"COPY users(user_id, username, email, created_at, status) FROM '/backup/clean_users.csv' WITH (FORMAT csv, HEADER true);\\\"\"\n",
            "is_blocking": true,
            "timeout_sec": 10.0
        },
        {
            "keystrokes": "cat > /tmp/import_json.sh << 'EOF'\n#!/bin/bash\nwhile IFS= read -r line; do\n    transaction_id=$(echo \"$line\" | jq -r '.transaction_id')\n    user_id=$(echo \"$line\" | jq -r '.user_id')\n    amount=$(echo \"$line\" | jq -r '.amount')\n    timestamp=$(echo \"$line\" | jq -r '.timestamp')\n    description=$(echo \"$line\" | jq -r '.description')\n    su - postgres -c \"psql -d production_db -c \\\"INSERT INTO transactions (transaction_id, user_id, amount, timestamp, description) VALUES ($transaction_id, $user_id, $amount, '$timestamp', '$description');\\\"\"\ndone < <(jq -c '.[]' /backup/valid_transactions.json)\nEOF\nchmod +x /tmp/import_json.sh\n",
            "is_blocking": true,
            "timeout_sec": 5.0
        },
        {
            "keystrokes": "/tmp/import_json.sh\n",
            "is_blocking": true,
            "timeout_sec": 30.0
        }
    ],
    "is_task_complete": false
}