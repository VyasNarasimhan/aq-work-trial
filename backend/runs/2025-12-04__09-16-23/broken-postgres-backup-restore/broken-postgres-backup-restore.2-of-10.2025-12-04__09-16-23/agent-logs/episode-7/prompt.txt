> valid_statuses = {'active', 'inactive', 'suspended'}
>
> # Email regex pattern
> email_pattern = re.compile(r'^[^@]+@[^@]+$')
>
> with open('/backup/users_export.csv', 'r') as infile, open('/backup/clean_users.csv', 'w', newline='') as outfile:
>     reader = csv.DictReader(infile)
>     writer = csv.DictWriter(outfile, fieldnames=['user_id', 'username', 'email', 'created_at', 'status'])
>     writer.writeheader()
>
>     for row in reader:
>         # Check if user_id is missing or empty
>         if not row.get('user_id') or row['user_id'].strip() == '':
>             continue
>
>         # Check if username is empty
>         if not row.get('username') or row['username'].strip() == '':
>             continue
>
>         # Check if email is valid (must contain @)
>         if not row.get('email') or not email_pattern.match(row['email']):
>             continue
>
>         # Check if status is valid
>         if not row.get('status') or row['status'] not in valid_statuses:
>             continue
>
>         # Write valid row
>         writer.writerow(row)
> EOF
root@dc6ca25e21c7:/backup# python3 /backup/clean_users.py; tmux wait -S done
root@dc6ca25e21c7:/backup# wc -l /backup/clean_users.csv; tmux wait -S done
31 /backup/clean_users.csv
root@dc6ca25e21c7:/backup# head -5 /backup/clean_users.csv; tmux wait -S done
user_id,username,email,created_at,status
1,alice_smith,alice_smith@example.com,2024-11-21 01:25:46,inactive
2,bob_jones,bob_jones@example.com,2025-06-28 01:25:46,active
3,charlie_brown,charlie_brown@example.com,2025-08-13 01:25:46,suspended
4,diana_prince,diana_prince@example.com,2025-08-05 01:25:46,inactive
root@dc6ca25e21c7:/backup#
